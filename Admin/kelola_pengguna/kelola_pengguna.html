<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <title>Kelola Pengguna</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background-color: #f1f5f9;
        font-family: "Segoe UI", sans-serif;
      }

      .sidebar {
        width: 250px;
        background-color: #1e293b;
        color: #fff;
        position: fixed;
        top: 0;
        bottom: 0;
        padding: 20px 10px;
      }

      .sidebar a {
        color: #cbd5e1;
        display: block;
        padding: 10px;
        border-radius: 8px;
        text-decoration: none;
        margin-bottom: 5px;
      }

      .sidebar a.active,
      .sidebar a:hover {
        background-color: #334155;
        color: #fff;
      }

      .main-content {
        margin-left: 260px;
        padding: 40px;
      }

      .table-container {
        background: #fff;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.05);
        border: 1px solid #ced4da;
      }

      .custom-btn {
        background-color: #1e2a3a;
        color: white;
        border: none;
        border-radius: 10px;
        padding: 10px 20px;
        font-weight: bold;
      }

      .custom-btn:hover {
        background-color: #2a3e50;
      }

      .avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        object-fit: cover;
        margin-right: 10px;
      }

      .action-icon {
        cursor: pointer;
        margin: 0 8px;
        font-size: 20px;
      }

      .action-icon.edit {
        color: #0d6efd;
      }

      .action-icon.delete {
        color: #dc3545;
      }

      select#filterRole {
        width: 160px;
        padding: 8px 10px;
        border-radius: 8px;
        border: 1px solid #ccc;
        font-size: 16px;
      }

      .badge {
        background-color: #e2e8f0;
        color: #1e293b;
        font-size: 16px;
        padding: 6px 12px;
        border-radius: 10px;
      }

      .table th {
        font-size: 16px;
      }

      .table td {
        font-size: 16px;
      }
    </style>
  </head>
  <body>
    <!-- navbar.html -->
    <div class="sidebar">
      <h2 class="mb-4">Quizku.</h2>
      <a href="#">Dashboard</a>
      <a href="../kelola_pengguna/kelola_pengguna.html" class="active"
        >Kelola Pengguna</a
      >
      <a href="#">Bank Soal</a>
      <a href="#">Histori Quiz</a>
      <a href="../Matakuliah/matakuliah.html">Matakuliah</a>
      <a href="#">Dosen</a>
      <a href="../Mahasiswa/mahasiswa.html">Mahasiswa</a>
      <a href="../Kelas/kelas.html">Kelas</a>
      <a href="#">Pengaturan</a>

      <div class="profile_sidebar mt-5 pt-4 border-top">
        <div class="d-flex align-items-center gap-2">
          <img
            src="https://i.pravatar.cc/40"
            class="rounded-circle"
            alt="User"
            width="32"
          />

          <div>
            <small>Dominick</small><br />
            <small class="text-light">Dominick@gmail.com</small>
          </div>
        </div>
        <a href="../login/login.html" class="btn btn-light btn-sm w-100 mt-3"
          >Logout</a
        >
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <h2 class="fw-bold mb-2">Kelola Pengguna</h2>
      <p class="mb-4">
        Di sini kamu bisa membuat dan mengatur akun untuk Mahasiswa, Dosen, dan
        Admin.
      </p>
      <div class="d-flex justify-content-end">
        <a href="tambah_user.html" class="text-decoration-none custom-btn"
          >+ Tambah User</a
        >
      </div>

      <div class="d-flex justify-content-between align-items-center mb-3">
        <input
          type="text"
          class="form-control w-25"
          id="cari"
          placeholder="Search..."
        />
        <div class="d-flex gap-2">
          <select id="filterRole">
            <option value="all">All Roles</option>
            <option value="mahasiswa">Mahasiswa</option>
            <option value="dosen">Dosen</option>
            <option value="admin">Admin</option>
          </select>
        </div>
      </div>

      <div class="table-container">
        <table class="table align-middle">
          <thead>
            <tr>
              <th>User</th>
              <th>Role</th>
              <th>Created</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="daftarPengguna">
            <!-- Data akan dimuat dari JavaScript -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Script Kelola Pengguna -->
    <script>
      function muatDataPengguna() {
        const tbody = document.getElementById("daftarPengguna");
        const cari = document.getElementById("cari").value.toLowerCase();
        const filterRole = document.getElementById("filterRole").value;
        tbody.innerHTML = "";

        const pengguna = JSON.parse(localStorage.getItem("pengguna")) || [];

        pengguna.forEach((user, index) => {
          const matchRole = filterRole === "all" || user.role === filterRole;
          const matchSearch =
            user.nama.toLowerCase().includes(cari) ||
            user.email.toLowerCase().includes(cari);

          if (matchRole && matchSearch) {
            const tr = document.createElement("tr");

            tr.innerHTML = `
              <td class="d-flex align-items-center">
                  <img src="https://i.pravatar.cc/150?img=${
                    index + 10
                  }" class="avatar" alt="User">
                  <div>
                      <div class="fw-semibold">${user.nama}</div>
                      <div class="text-muted small">${user.email}</div>
                  </div>
              </td>
              <td><span class="badge text-capitalize">${user.role}</span></td>
              <td>${user.created}</td>
              <td>
                  <span class="action-icon edit" onclick="editPengguna(${index})">&#9998;</span>
                  <span class="action-icon delete" onclick="hapusPengguna(${index})">&#128465;</span>
              </td>
            `;
            tbody.appendChild(tr);
          }
        });
      }

      function hapusPengguna(index) {
        if (confirm("Yakin ingin menghapus pengguna ini?")) {
          const data = JSON.parse(localStorage.getItem("pengguna")) || [];
          data.splice(index, 1);
          localStorage.setItem("pengguna", JSON.stringify(data));
          muatDataPengguna();
        }
      }

      function editPengguna(index) {
        localStorage.setItem("editIndex", index);
        window.location.href = "edit_user.html";
      }

      document
        .getElementById("filterRole")
        .addEventListener("change", muatDataPengguna);
      document
        .getElementById("cari")
        .addEventListener("input", muatDataPengguna);

      window.onload = muatDataPengguna;
    </script>
  </body>
</html>
